currentBuild.displayName = "MyAppBuild#" + currentBuild.number
pipeline{
  agent any
  stages{
      stage("Code Checkout"){
        steps{
          git branch: 'devops', url: 'https://github.com/gauravjadhav8/my-app'
        }
      }
      stage("Compile-Package"){
        steps{
              sh "mvn clean package"
          }
      }
      stage("Push to DockerHub"){
        steps{
            withDockerRegistry(credentialsId: 'ecr:af-south-1:aws-ecr-gaurav', url: 'https://612359323314.dkr.ecr.ap-south-1.amazonaws.com/mytestapp') {
                def newImg = docker.build "612359323314.dkr.ecr.ap-south-1.amazonaws.com/mytestapp:peace"
                newImg.push()
          }
        }
      }
   }
}
